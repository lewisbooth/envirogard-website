"use strict";var form=document.forms.product,inputs={title:form.querySelector('input[name="title"]'),subcategory:form.querySelector('select[name="subcategory"]'),shortDescription:form.querySelector('textarea[name="shortDescription"]'),metaTitle:form.querySelector('input[name="metaTitle"]'),metaDescription:form.querySelector('textarea[name="metaDescription"]'),youtubeID:form.querySelector('input[name="youtubeID"]')},deleteManual=form.querySelector('input[name="deleteManual"]'),newImageInput=form.querySelector('input[name="newImage"]'),newImageText=form.querySelector(".edit-product__images--new--text"),imagesContainer=form.querySelector(".edit-product__images"),newImageBlock=imagesContainer.querySelector(".edit-product__images--new"),copyFromTitleLink=form.querySelector("#copy-from-title"),copyFromDescriptionLink=form.querySelector("#copy-from-description"),featuresContainer=form.querySelector('div[data-multi="features"]'),featureInputs=featuresContainer.querySelectorAll("input"),specsContainer=form.querySelector('div[data-multi="specifications"]'),specInputs=specsContainer.querySelectorAll("div[data-key]"),addSpec=specsContainer.querySelector(".multiple-input__add"),manualPDF=form.querySelector('input[name="manualPDF"]'),uploadProgress=document.querySelector(".admin__upload-progress"),uploadProgressBar=uploadProgress.querySelector("progress"),deleteConfirmation=document.querySelector("#delete-item__lightbox"),editorElement=document.getElementById("pell"),descriptionContent=document.getElementById("pell-data").value;newImageInput.addEventListener("change",addNewImage),copyFromTitleLink.addEventListener("click",copyFromTitle),copyFromDescriptionLink.addEventListener("click",copyFromDescription);var editor=pell.init({defaultParagraphSeparator:"p",element:editorElement,actions:["bold","italic","heading2","paragraph","link","olist","ulist"],onChange:function(e){}});editor.content.innerHTML=descriptionContent,editor.addEventListener("paste",function(e){e.preventDefault();var t=(e.originalEvent||e).clipboardData.getData("text/plain");document.execCommand("insertHTML",!1,t)});var newImageBlockTemplate=newImageBlock.innerHTML;function addNewImage(e){var t=e.target;if(t.files&&t.files[0]){var a=new FileReader;a.onload=function(e){var t=imagesContainer.querySelectorAll(".edit-product__images--entry").length;if(!(t>20)){var a=renderTemplate('\n        <div \n          class="edit-product__images--entry" \n          data-key='+t+'\n          draggable="true" \n          ondragstart="imageDragStart(event)" \n          ondragenter="dragEnter(event)" \n          ondragleave="dragLeave(event)" \n          ondragover="dragOver(event)" \n          ondrop="imageDrop(event)" >\n          <img src="#"/>\n          <div class="edit-product__images--entry--delete" onclick="deleteImage(event)">×</div> \n        </div>\n      ');a.querySelector("img").setAttribute("src",e.target.result),newImageInput.setAttribute("name","image-"+t),a.appendChild(newImageInput),imagesContainer.insertBefore(a,newImageBlock),newImageBlock.innerHTML=newImageBlockTemplate,(newImageInput=newImageBlock.querySelector('input[name="newImage"]')).addEventListener("change",addNewImage)}},a.readAsDataURL(t.files[0])}}function deleteImage(e){var t=e.target.parentElement.dataset.key,a=imagesContainer.querySelector('[data-key="'+t+'"]');a&&imagesContainer.removeChild(a)}function imageDragStart(e){var t=e.target.dataset.key?e.target.dataset.key:e.target.parentNode.dataset.key;e.dataTransfer.setData("startIndex",t)}function imageDrop(e){e.preventDefault(),e.target.classList.remove("dragover");var t=e.dataTransfer.getData("startIndex"),a=e.target.dataset.key?e.target.dataset.key:e.target.parentNode.dataset.key;if(t&&a){var n=imagesContainer.querySelector('[data-key="'+t+'"]'),r=imagesContainer.querySelector('[data-key="'+a+'"]');imagesContainer.insertBefore(n,r),updateImageKeys()}}function updateImageKeys(){imagesContainer.querySelectorAll(".edit-product__images--entry").forEach(function(e,t){return e.dataset.key=t})}function copyFromTitle(){inputs.title.value&&(inputs.metaTitle.value=inputs.title.value)}function copyFromDescription(){inputs.shortDescription.value&&(inputs.metaDescription.value=inputs.shortDescription.value)}var features=[""];function getFeaturesFromDOM(){features=[],featureInputs.forEach(function(e){features.push(e.value)})}function updateFeature(e){var t=e.target.parentElement.dataset.key;features[t]=e.target.value}function addFeature(){""!==features[features.length-1]&&(features.push(""),renderFeatures())}function deleteFeature(e){var t=e.target.parentElement.dataset.key;1===features.length?features=[""]:features.splice(t,1),renderFeatures()}getFeaturesFromDOM();var featureTemplate=function(e,t){return'\n  <div data-key="'+t+'">\n    <input type="text" value="'+e+'" onchange="updateFeature(event)"/>\n    <div class="multiple-input__delete" onclick="deleteFeature(event)">×</div> \n  </div>\n'};function renderFeatures(){var e="";(features=features.filter(function(e,t){return!(t!==features.length-1&&""===e)})).forEach(function(t,a){return e+=featureTemplate(features[a],a)}),e+='<div class="multiple-input__add" onclick="addFeature()">Add Feature</div>',featuresContainer.innerHTML=e}renderFeatures();var specifications=[["key","value"]];function getSpecificationsFromDOM(){specifications=[],specInputs.forEach(function(e){var t=e.querySelector('[data-type="key"]').value,a=e.querySelector('[data-type="value"]').value;specifications.push([t,a])})}function updateSpecification(e){var t=e.target.parentElement,a=t.dataset.key,n=t.querySelector('[data-type="key"]').value,r=t.querySelector('[data-type="value"]').value;specifications[a]=[n,r]}function addSpecification(){var e=specifications[specifications.length-1];""===e[0]&&""===e[1]||(specifications.push(["",""]),renderSpecifications())}function deleteSpecification(e){var t=e.target.parentElement.dataset.key;1===specifications.length?specifications=[["",""]]:specifications.splice(t,1),renderSpecifications()}getSpecificationsFromDOM();var specificationTemplate=function(e,t){return'\n  <div data-key="'+t+'">\n    <input type="text" value="'+e[0]+'" data-type="key" onchange="updateSpecification(event)"/>\n    <input type="text" value="'+e[1]+'" data-type="value" onchange="updateSpecification(event)"/>\n    <div class="multiple-input__delete" onclick="deleteSpecification(event)">×</div> \n  </div>'};function renderSpecifications(){var e="";(specifications=specifications.filter(function(e,t){return!(t!==specifications.length-1&&""===e[0]&&""===e[1])})).forEach(function(t,a){e+=specificationTemplate(t,a)}),e+='<div class="multiple-input__add" onclick="addSpecification()">Add Specification</div>',specsContainer.innerHTML=e}function submitForm(e){e.preventDefault(),errors.clear();var t=new FormData,a=!1;for(var n in inputs)inputs[n]&&t.append(n,inputs[n].value);deleteManual&&deleteManual.checked&&t.append("deleteManual",!0);var r=specifications.filter(function(e){return!(""===e[0]&&""===e[1])}),i=features.filter(function(e){return!(""===e)});t.append("specifications",JSON.stringify(r)),t.append("features",JSON.stringify(i)),manualPDF.files&&manualPDF.files[0]&&(t.append("manualPDF",manualPDF.files[0],"manual.pdf"),a=!0),editor.content.innerText.length>1?t.append("longDescription",editor.content.innerHTML):t.append("longDescription",""),imagesContainer.querySelectorAll(".edit-product__images--entry").forEach(function(e,n){var r=e.querySelector("input"),i=e.dataset.id;r&&r.files&&r.files[0]?(t.append("image-"+n,r.files[0]),a=!0):i&&t.append("image-"+n,i)}),a&&uploadProgress.classList.add("active");axios.post(window.location.pathname,t,{onUploadProgress:function(e){return uploadProgressBar.value=e.loaded/e.total}}).then(function(){return window.location="/dashboard/products"}).catch(function(e){var t=e.response.data||{title:"Error uploading product",text:"Please try again. If the problem persists, please contact AMP."};errors.flash(t.title,t.text)})}function toggleDeleteConfirmation(){deleteConfirmation.classList.toggle("active")}function dragOver(e){e.preventDefault()}function dragEnter(e){e.preventDefault(),e.target.classList.add("dragover")}function dragLeave(e){e.preventDefault(),e.target.classList.remove("dragover")}function renderTemplate(e){var t=document.createElement("div");return t.innerHTML=e.trim(),t.firstChild}renderSpecifications();