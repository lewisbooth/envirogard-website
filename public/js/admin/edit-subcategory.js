"use strict";var form=document.forms.subcategory,imageInput=form.querySelector('[name="coverImage"]'),imagePreviewContainer=form.querySelector(".image-preview"),imagePreview=imagePreviewContainer.querySelector(".image-preview img"),copyFromTitleLink=form.querySelector("#copy-from-title"),copyFromDescriptionLink=form.querySelector("#copy-from-description"),addProductInput=form.querySelector('[name="productDropdown"]'),autocompleteContainer=form.querySelector(".edit-linked__listings--autocomplete"),autocompleteResults=form.querySelector(".edit-linked__listings--autocomplete ul"),productContainer=form.querySelector(".edit-linked__listings--container"),deleteConfirmation=document.querySelector("#delete-item__lightbox"),uploadProgress=document.querySelector(".admin__upload-progress"),uploadProgressBar=uploadProgress.querySelector("progress"),inputs={title:form.querySelector('input[name="title"]'),category:form.querySelector('select[name="category"]'),shortDescription:form.querySelector('textarea[name="shortDescription"]'),longDescription:form.querySelector('textarea[name="longDescription"]'),metaTitle:form.querySelector('input[name="metaTitle"]'),metaDescription:form.querySelector('textarea[name="metaDescription"]'),deleteImage:form.querySelector('input[name="deleteImage"]')};function copyFromTitle(){inputs.title.value&&(inputs.metaTitle.value=inputs.title.value+" for Hire")}function copyFromDescription(){inputs.shortDescription.value&&(inputs.metaDescription.value=inputs.shortDescription.value)}function previewImage(e){var t=e.target;if(t.files&&t.files[0]){var r=new FileReader;r.onload=function(e){imagePreview.setAttribute("src",e.target.result),imagePreviewContainer.removeAttribute("hidden")},r.readAsDataURL(t.files[0])}else imagePreview.setAttribute("src",""),imagePreviewContainer.setAttribute("hidden",!0)}imageInput.addEventListener("change",previewImage),addProductInput.addEventListener("keyup",openDropdown),addProductInput.addEventListener("focusin",openDropdown),copyFromTitleLink.addEventListener("click",copyFromTitle),copyFromDescriptionLink.addEventListener("click",copyFromDescription);var products=[],SEARCH_API="/api/products/search";function openDropdown(){renderDropdown([],"Searching for products..."),axios.post(SEARCH_API,{search:addProductInput.value}).then(function(e){renderDropdown(e.data)})}function renderDropdown(e,t){var r=e.filter(function(e){var t=!1;return products.forEach(function(r){r.id===e.id&&(t=!0)}),!t});r.length>0?autocompleteResults.innerHTML=r.map(function(e){return'<li data-id="'+e.id+'" \n        data-edit="'+e.editURL+'" \n        onmousedown="addProduct(event)">\n          '+e.title+"\n      </li>"}).join(""):autocompleteResults.innerHTML=t?"<li>"+t+"</li>":"<li>No products found</li>",autocompleteContainer.removeAttribute("hidden")}function updateProductsFromDOM(){var e=productContainer.querySelectorAll("div[data-id]")||[];products=[],e.forEach(function(e){var t=e.dataset.id,r=e.querySelector(".button").getAttribute("href"),o=e.querySelector("span").innerText;products.push({id:t,editURL:r,title:o})})}function addProduct(e){products.push({id:e.target.dataset.id,title:e.target.innerText,editURL:e.target.dataset.edit}),sortProductList(),renderProductList(),addProductInput.value=""}function removeProduct(e){var t=e.target.parentElement.parentElement.dataset.id,r=0;products.forEach(function(e,o){e.id===t&&(r=o)}),products.splice(r,1),renderProductList()}function sortProductList(){products=products.sort(function(e,t){return e.title>t.title})}function renderProductList(){productContainer.innerHTML=products.map(function(e){return'\n    <div data-id="'+e.id+'">\n      <span>'+e.title+"</span>\n      <div>\n        <a href="+e.editURL+' class="button" target="_blank">Edit Product</a>\n        <span onclick="removeProduct(event)">Remove</span>\n      </div>\n    </div>\n  '}).join("")}function submitForm(e){e.preventDefault(),errors.clear();var t=new FormData;for(var r in inputs)inputs[r]&&t.append(r,inputs[r].value);imageInput.files&&imageInput.files[0]&&(t.append("coverImage",imageInput.files[0]),uploadProgress.classList.add("active")),t.append("products",JSON.stringify(products.map(function(e){return e.id})));axios.post(window.location.pathname,t,{onUploadProgress:function(e){return uploadProgressBar.value=e.loaded/e.total}}).then(function(){return window.location="/dashboard/subcategories"}).catch(function(e){var t=e.response.data||{title:"Error uploading category",text:"Please try again. If the problem persists, please contact AMP."};errors.flash(t.title,t.text)})}function toggleDeleteConfirmation(){deleteConfirmation.classList.toggle("active")}updateProductsFromDOM();