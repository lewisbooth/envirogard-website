"use strict";var form=document.forms.subcategory,addSubcategoryInput=form.querySelector('[name="subcategoryDropdown"]'),autocompleteContainer=form.querySelector(".edit-linked__listings--autocomplete"),autocompleteResults=form.querySelector(".edit-linked__listings--autocomplete ul"),subcategoryContainer=form.querySelector(".edit-linked__listings--container"),MAX_SUBCATEGORIES=5;addSubcategoryInput.addEventListener("keyup",openDropdown),addSubcategoryInput.addEventListener("focusin",openDropdown);var subcategories=[],SEARCH_API="/api/subcategories/search";function openDropdown(){renderDropdown([],"Searching for subcategories..."),axios.post(SEARCH_API,{search:addSubcategoryInput.value}).then(function(e){renderDropdown(e.data)})}function renderDropdown(e,t){var r=e.filter(function(e){var t=!1;return subcategories.forEach(function(r){r.id===e.id&&(t=!0)}),!t});r.length>0?autocompleteResults.innerHTML=r.map(function(e){return'<li data-id="'+e.id+'" \n        data-edit="'+e.editURL+'" \n        onmousedown="addSubcategory(event)">\n          '+e.title+"\n      </li>"}).join(""):autocompleteResults.innerHTML=t?"<li>"+t+"</li>":"<li>No subcategories found</li>",autocompleteContainer.removeAttribute("hidden")}function updateSubcategoriesFromDOM(){var e=subcategoryContainer.querySelectorAll("div[data-id]")||[];subcategories=[],e.forEach(function(e){var t=e.dataset.id,r=e.querySelector(".button").getAttribute("href"),o=e.querySelector("span").innerText;subcategories.push({id:t,editURL:r,title:o})})}function addSubcategory(e){subcategories.length>=MAX_SUBCATEGORIES||(subcategories.push({id:e.target.dataset.id,title:e.target.innerText,editURL:e.target.dataset.edit}),sortSubcategoryList(),renderSubcategoryList(),addSubcategoryInput.value="")}function removeSubcategory(e){var t=e.target.parentElement.parentElement.dataset.id,r=0;subcategories.forEach(function(e,o){e.id===t&&(r=o)}),subcategories.splice(r,1),renderSubcategoryList()}function sortSubcategoryList(){subcategories=subcategories.sort(function(e,t){return e.title>t.title})}function renderSubcategoryList(){subcategoryContainer.innerHTML=subcategories.map(function(e){return'\n    <div data-id="'+e.id+'">\n      <span>'+e.title+"</span>\n      <div>\n        <a href="+e.editURL+' class="button" target="_blank">Edit Subcategory</a>\n        <span onclick="removeSubcategory(event)">Remove</span>\n      </div>\n    </div>\n  '}).join("")}function submitForm(e){e.preventDefault(),errors.clear(),axios.post(window.location.pathname,{popularProducts:JSON.stringify(subcategories.map(function(e){return e.id}))}).then(function(){return window.location="/dashboard/settings"}).catch(function(e){var t=e.response.data||{title:"Error uploading subcategory",text:"Please try again. If the problem persists, please contact AMP."};errors.flash(t.title,t.text)})}updateSubcategoriesFromDOM();