"use strict";var form=document.forms.industry,imageInput=form.querySelector('[name="coverImage"]'),imagePreviewContainer=form.querySelector(".image-preview"),imagePreview=imagePreviewContainer.querySelector(".image-preview img"),copyFromTitleLink=form.querySelector("#copy-from-title"),copyFromDescriptionLink=form.querySelector("#copy-from-description"),uploadProgress=document.querySelector(".admin__upload-progress"),uploadProgressBar=uploadProgress.querySelector("progress"),deleteConfirmation=document.querySelector("#delete-item__lightbox"),editorElement=document.getElementById("pell"),descriptionContent=document.getElementById("pell-data").value,subcategoryContainer=document.querySelector(".edit-linked__listings--container"),addSubcategoryInput=form.querySelector('[name="subcategoryDropdown"]'),autocompleteContainer=form.querySelector(".edit-linked__listings--autocomplete"),autocompleteResults=form.querySelector(".edit-linked__listings--autocomplete ul"),inputs={title:form.querySelector('input[name="title"]'),metaTitle:form.querySelector('input[name="metaTitle"]'),metaDescription:form.querySelector('textarea[name="metaDescription"]'),deleteImage:form.querySelector('input[name="deleteImage"]')};addSubcategoryInput.addEventListener("keyup",openDropdown),addSubcategoryInput.addEventListener("focusin",openDropdown),copyFromTitleLink.addEventListener("click",copyFromTitle),imageInput.addEventListener("change",previewImage);var editor=pell.init({element:editorElement,actions:["bold","italic","heading1","heading2","paragraph","link","olist","ulist"],onChange:function(e){}});function previewImage(e){var t=e.target;if(t.files&&t.files[0]){var r=new FileReader;r.onload=function(e){imagePreview.setAttribute("src",e.target.result),imagePreviewContainer.removeAttribute("hidden")},r.readAsDataURL(t.files[0])}else imagePreview.setAttribute("src",""),imagePreviewContainer.setAttribute("hidden",!0)}function copyFromTitle(){inputs.title.value&&(inputs.metaTitle.value=inputs.title.value)}editor.content.innerHTML=descriptionContent;var subcategories=[],SEARCH_API="/api/subcategories/search";function openDropdown(){renderDropdown([],"Searching for subcategories..."),axios.post(SEARCH_API,{search:addSubcategoryInput.value}).then(function(e){renderDropdown(e.data)})}function renderDropdown(e,t){var r=e.filter(function(e){var t=!1;return subcategories.forEach(function(r){r.id===e.id&&(t=!0)}),!t});r.length>0?autocompleteResults.innerHTML=r.map(function(e){return'<li data-id="'+e.id+'" \n        data-edit="'+e.editURL+'" \n        onmousedown="addSubcategory(event)">\n          '+e.title+"\n      </li>"}).join(""):autocompleteResults.innerHTML=t?"<li>"+t+"</li>":"<li>No subcategories found</li>",autocompleteContainer.removeAttribute("hidden")}function updateSubcategoriesFromDOM(){var e=subcategoryContainer.querySelectorAll("div[data-id]")||[];subcategories=[],e.forEach(function(e){var t=e.dataset.id,r=e.querySelector(".button").getAttribute("href"),i=e.querySelector("span").innerText;subcategories.push({id:t,editURL:r,title:i})})}function addSubcategory(e){subcategories.push({id:e.target.dataset.id,title:e.target.innerText,editURL:e.target.dataset.edit}),sortSubcategoryList(),renderSubcategoryList(),addSubcategoryInput.value=""}function removeSubcategory(e){var t=e.target.parentElement.parentElement.dataset.id,r=0;subcategories.forEach(function(e,i){e.id===t&&(r=i)}),subcategories.splice(r,1),renderSubcategoryList()}function sortSubcategoryList(){subcategories=subcategories.sort(function(e,t){return e.title>t.title})}function renderSubcategoryList(){subcategoryContainer.innerHTML=subcategories.map(function(e){return'\n    <div data-id="'+e.id+'">\n      <span>'+e.title+"</span>\n      <div>\n        <a href="+e.editURL+' class="button" target="_blank">Edit Subcategory</a>\n        <span onclick="removeSubcategory(event)">Remove</span>\n      </div>\n    </div>\n  '}).join("")}function submitForm(e){e.preventDefault(),errors.clear();var t=new FormData;for(var r in inputs)inputs[r]&&t.append(r,inputs[r].value);t.append("description",editor.content.innerHTML),t.append("subcategories",JSON.stringify(subcategories.map(function(e){return e.id}))),imageInput.files&&imageInput.files[0]&&(t.append("coverImage",imageInput.files[0]),uploadProgress.classList.add("active"));axios.post(window.location.pathname,t,{onUploadProgress:function(e){return uploadProgressBar.value=e.loaded/e.total}}).then(function(){return window.location="/dashboard/industries"}).catch(function(e){var t=e.response.data||{title:"Error uploading industry",text:"Please try again. If the problem persists, please contact AMP."};errors.flash(t.title,t.text)})}function toggleDeleteConfirmation(){deleteConfirmation.classList.toggle("active")}updateSubcategoriesFromDOM();